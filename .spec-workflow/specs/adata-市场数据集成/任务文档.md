# 任务文档

## 第一阶段：核心功能实现 (MVP - 资金流向)

- [ ] 1. 创建资金流向数据提供器核心模块
  - 文件: tradingagents/dataflows/market_data_capital_flow_utils.py
  - 实现个股和概念资金流向数据获取功能
  - 集成东方财富、百度等多数据源支持
  - 目的: 为AI技术分析师提供资金流向分析能力
  - _复用: tradingagents/dataflows/akshare_utils.py, tradingagents/utils/unified_cache_manager.py_
  - _需求: 1.1 资金流向数据集成_
  - _参考文件: /Users/yyj/GitProject/adata/adata/stock/market/capital_flow/stock_capital_flow.py, stock_capital_flow_east.py, stock_capital_flow_baidu.py_
  - _提示: 实现规范 adata-市场数据集成 任务，首先运行 spec-workflow-guide 获取工作流指南然后实现任务：角色: Python数据工程师专精金融数据API集成 | 任务: 创建资金流向数据提供器，实现个股和概念的资金流向数据获取，支持多数据源和缓存机制，遵循需求1.1 | 限制: 必须复用现有的AKShare工具和统一缓存管理器，不得破坏现有数据流架构，确保数据格式与现有系统兼容 | 成功标准: 能够成功获取个股资金流向数据，支持实时和历史数据，缓存机制正常工作，错误处理完善 | 指令: 在tasks.md中将此任务标记为进行中[-]，完成后标记为已完成[x]_

- [ ] 2. 扩展DataSourceManager支持资金流向数据源
  - 文件: tradingagents/dataflows/data_source_manager.py (扩展现有文件)
  - 在现有DataSourceManager类中添加资金流向数据源管理方法
  - 实现智能降级机制和错误处理
  - 目的: 将资金流向数据源纳入统一数据源管理
  - _复用: 现有DataSourceManager架构和ChinaDataSource枚举_
  - _需求: 1.1 资金流向数据集成, 5.1 统一数据源管理_
  - _参考文件: /Users/yyj/GitProject/adata/adata/stock/market/__init__.py (Market类的多继承模式), capital_flow/__init__.py_
  - _提示: 实现规范 adata-市场数据集成 任务，首先运行 spec-workflow-guide 获取工作流指南然后实现任务：角色: 系统架构师专精数据源管理和降级策略 | 任务: 扩展现有DataSourceManager类支持资金流向数据源，实现智能降级和错误处理，遵循需求1.1和5.1 | 限制: 不得修改现有DataSourceManager的核心架构，必须保持向后兼容，遵循现有的数据源枚举和管理模式 | 成功标准: 资金流向数据源成功集成到管理器，降级机制工作正常，与现有数据源无冲突 | 指令: 在tasks.md中将此任务标记为进行中[-]，完成后标记为已完成[x]_

- [ ] 3. 在统一接口中暴露资金流向API
  - 文件: tradingagents/dataflows/interface.py (扩展现有文件)
  - 添加`get_capital_flow_data`和`get_capital_flow_realtime`函数
  - 集成到现有的统一接口模式
  - 目的: 为AI分析师提供统一的资金流向数据访问接口
  - _复用: 现有interface.py的函数模式和类型注解规范_
  - _需求: 1.1 资金流向数据集成_
  - _参考文件: /Users/yyj/GitProject/adata/adata/stock/market/capital_flow/stock_capital_flow.py (StockCapitalFlow.get_capital_flow, get_capital_flow_min方法)_
  - _提示: 实现规范 adata-市场数据集成 任务，首先运行 spec-workflow-guide 获取工作流指南然后实现任务：角色: API开发工程师专精统一接口设计 | 任务: 在interface.py中添加资金流向数据获取函数，遵循现有的接口模式和类型注解规范，实现需求1.1 | 限制: 必须遵循现有接口的命名规范和参数模式，确保类型注解完整，不得破坏现有接口的向后兼容性 | 成功标准: 新增函数完全集成到统一接口，类型注解正确，参数验证完善，返回格式与现有接口一致 | 指令: 在tasks.md中将此任务标记为进行中[-]，完成后标记为已完成[x]_

- [ ] 4. 更新动态导入配置支持资金流向功能
  - 文件: tradingagents/dataflows/__init__.py (修改现有文件)
  - 在动态导入映射中添加资金流向相关函数
  - 确保延迟加载和错误处理正常工作
  - 目的: 支持资金流向功能的按需导入
  - _复用: 现有的__getattr__机制和_import_cache缓存_
  - _需求: 1.1 资金流向数据集成_
  - _参考文件: /Users/yyj/GitProject/adata/adata/stock/market/__init__.py (动态导入和模块加载模式)_
  - _提示: 实现规范 adata-市场数据集成 任务，首先运行 spec-workflow-guide 获取工作流指南然后实现任务：角色: Python模块系统专家专精动态导入和延迟加载 | 任务: 在__init__.py中添加资金流向功能的动态导入支持，遵循现有的延迟导入模式，实现需求1.1 | 限制: 必须严格遵循现有的__getattr__机制，不得改变导入缓存逻辑，确保新功能的导入错误不影响现有模块 | 成功标准: 资金流向功能可以正常动态导入，缓存机制工作正常，错误处理不影响其他模块导入 | 指令: 在tasks.md中将此任务标记为进行中[-]，完成后标记为已完成[x]_

- [ ] 5. 创建资金流向功能单元测试
  - 文件: tests/dataflows/test_capital_flow_utils.py
  - 编写资金流向数据获取的单元测试
  - 测试多数据源降级和缓存机制
  - 目的: 确保资金流向功能的可靠性和稳定性
  - _复用: tests/中现有的测试工具和fixture_
  - _需求: 1.1 资金流向数据集成_
  - _参考文件: /Users/yyj/GitProject/adata/adata/stock/market/capital_flow/stock_capital_flow_template.py (模板和测试用例模式)_
  - _提示: 实现规范 adata-市场数据集成 任务，首先运行 spec-workflow-guide 获取工作流指南然后实现任务：角色: 质量保证工程师专精Python单元测试和mock技术 | 任务: 创建资金流向功能的全面单元测试，覆盖数据获取、缓存、降级等场景，遵循需求1.1 | 限制: 必须mock外部API调用，遵循现有测试框架规范，确保测试独立性和可重复性 | 成功标准: 测试覆盖所有核心功能，包括成功和失败场景，mock正确，测试可独立运行 | 指令: 在tasks.md中将此任务标记为进行中[-]，完成后标记为已完成[x]_

## 第二阶段：扩展功能 (概念板块 + 股息数据)

- [ ] 6. 创建概念板块数据提供器
  - 文件: tradingagents/dataflows/market_data_concept_utils.py
  - 实现概念板块排名、成分股查询等功能
  - 集成多数据源支持和缓存机制
  - 目的: 为AI基本面分析师提供概念板块分析能力
  - _复用: market_data_capital_flow_utils.py的架构模式_
  - _需求: 2.1 概念/板块分析集成_
  - _参考文件: /Users/yyj/GitProject/adata/adata/stock/market/concepth_market/concept_market_east.py, concept_market_ths.py (概念排名和成分股数据获取)_
  - _提示: 实现规范 adata-市场数据集成 任务，首先运行 spec-workflow-guide 获取工作流指南然后实现任务：角色: 金融数据分析师专精概念板块和主题投资 | 任务: 创建概念板块数据提供器，实现概念排名、成分股等功能，复用资金流向模块的架构模式，遵循需求2.1 | 限制: 必须复用已建立的数据获取和缓存架构，确保与现有数据格式兼容，不得重复实现相同功能 | 成功标准: 能够获取概念板块排名数据，支持成分股查询，缓存和错误处理完善 | 指令: 在tasks.md中将此任务标记为进行中[-]，完成后标记为已完成[x]_

- [ ] 7. 创建股息数据提供器
  - 文件: tradingagents/dataflows/market_data_dividend_utils.py
  - 实现历史分红数据和股息率计算功能
  - 集成到统一缓存和数据源管理
  - 目的: 为AI基本面分析师提供股息分析能力
  - _复用: 现有市场数据模块的架构和缓存机制_
  - _需求: 3.1 股息信息集成_
  - _参考文件: /Users/yyj/GitProject/adata/adata/stock/market/stock_dividend.py (StockDividend.get_dividend方法和分红数据处理)_
  - _提示: 实现规范 adata-市场数据集成 任务，首先运行 spec-workflow-guide 获取工作流指南然后实现任务：角色: 基本面分析专家专精股息和分红政策分析 | 任务: 创建股息数据提供器，实现历史分红数据获取和股息率计算，遵循需求3.1 | 限制: 必须复用现有的数据架构模式，确保股息数据格式与基本面分析需求匹配，不得跳过数据验证 | 成功标准: 能够获取完整的股息历史数据，股息率计算准确，数据验证完善 | 指令: 在tasks.md中将此任务标记为进行中[-]，完成后标记为已完成[x]_

- [ ] 8. 扩展统一接口支持新数据类型
  - 文件: tradingagents/dataflows/interface.py (继续扩展)
  - 添加概念板块和股息相关API函数
  - 确保接口一致性和向后兼容
  - 目的: 为AI分析师提供完整的市场数据访问能力
  - _复用: 已建立的接口模式和类型系统_
  - _需求: 2.1 概念/板块分析集成, 3.1 股息信息集成_
  - _参考文件: /Users/yyj/GitProject/adata/adata/stock/market/concept_capital_flow/concept_flow.py (概念资金流向接口), stock_dividend.py (股息数据接口)_
  - _提示: 实现规范 adata-市场数据集成 任务，首先运行 spec-workflow-guide 获取工作流指南然后实现任务：角色: API架构师专精统一接口设计和向后兼容 | 任务: 扩展interface.py添加概念板块和股息API，确保接口一致性，遵循需求2.1和3.1 | 限制: 必须保持接口命名和参数的一致性，确保向后兼容，不得破坏现有接口的使用模式 | 成功标准: 新API完全集成到统一接口，接口设计一致，文档完整 | 指令: 在tasks.md中将此任务标记为进行中[-]，完成后标记为已完成[x]_

- [ ] 9. 完善缓存策略和错误处理机制
  - 文件: 对相关模块进行优化
  - 实现智能缓存TTL策略和统一错误处理
  - 优化性能和稳定性
  - 目的: 提升系统整体性能和可靠性
  - _复用: tradingagents/utils/unified_cache_manager.py_
  - _需求: 5.1 统一数据源管理, 非功能性需求_
  - _参考文件: /Users/yyj/GitProject/adata/adata/stock/market/capital_flow/stock_capital_flow_template.py, index_market/market_index_template.py (错误处理和重试机制模板)_
  - _提示: 实现规范 adata-市场数据集成 任务，首先运行 spec-workflow-guide 获取工作流指南然后实现任务：角色: 系统性能优化工程师专精缓存策略和错误处理 | 任务: 完善缓存策略和错误处理，优化系统性能和稳定性，遵循需求5.1和非功能性需求 | 限制: 必须基于现有统一缓存管理器，不得实现重复的缓存逻辑，确保错误处理不影响系统稳定性 | 成功标准: 缓存策略智能高效，错误处理完善，系统性能提升明显 | 指令: 在tasks.md中将此任务标记为进行中[-]，完成后标记为已完成[x]_

## 第三阶段：系统完善和AI分析师集成

- [ ] 10. 为技术分析师添加资金流向工具
  - 文件: tradingagents/agents/ 相关分析师模块
  - 将资金流向数据集成到技术分析工作流
  - 提供资金流向指标和分析建议
  - 目的: 增强技术分析师的分析能力和准确性
  - _复用: 现有AI分析师的工具调用架构_
  - _需求: 1.1 资金流向数据集成_
  - _参考文件: /Users/yyj/GitProject/adata/adata/stock/market/concept_capital_flow/capital_flow_east.py (概念资金流向分析模式)_
  - _提示: 实现规范 adata-市场数据集成 任务，首先运行 spec-workflow-guide 获取工作流指南然后实现任务：角色: AI系统集成工程师专精智能体工具增强 | 任务: 为技术分析师智能体添加资金流向分析工具，集成到现有分析工作流，遵循需求1.1 | 限制: 必须遵循现有AI分析师的工具调用模式，不得破坏现有分析流程，确保新工具与现有工具协调工作 | 成功标准: 技术分析师能够有效使用资金流向数据，分析准确性提升，工具集成无缝 | 指令: 在tasks.md中将此任务标记为进行中[-]，完成后标记为已完成[x]_

- [ ] 11. 为基本面分析师添加概念和股息工具
  - 文件: tradingagents/agents/ 相关分析师模块
  - 集成概念板块分析和股息评估功能
  - 增强基本面分析的深度和广度
  - 目的: 提升基本面分析师的投资洞察能力
  - _复用: 现有基本面分析师的分析框架_
  - _需求: 2.1 概念/板块分析集成, 3.1 股息信息集成_
  - _参考文件: /Users/yyj/GitProject/adata/adata/stock/market/concepth_market/concept_market_east.py (概念分析工具), stock_dividend.py (股息评估工具)_
  - _提示: 实现规范 adata-市场数据集成 任务，首先运行 spec-workflow-guide 获取工作流指南然后实现任务：角色: 基本面分析专家专精价值投资和股息分析 | 任务: 为基本面分析师添加概念板块和股息分析工具，遵循需求2.1和3.1 | 限制: 必须与现有基本面分析框架协调，确保新工具增强而非替代现有分析能力，保持分析逻辑的一致性 | 成功标准: 基本面分析师能够进行概念主题分析和股息评估，投资建议质量提升 | 指令: 在tasks.md中将此任务标记为进行中[-]，完成后标记为已完成[x]_

- [ ] 12. 创建集成测试套件
  - 文件: tests/integration/test_market_data_integration.py
  - 编写端到端集成测试
  - 测试AI分析师与新数据源的协作
  - 目的: 确保整体系统集成的正确性和稳定性
  - _复用: 现有集成测试框架和工具_
  - _需求: 所有需求的集成验证_
  - _参考文件: /Users/yyj/GitProject/adata/adata/stock/market/stock_market/stock_market.py (集成多数据源的测试模式), stock_market_template.py_
  - _提示: 实现规范 adata-市场数据集成 任务，首先运行 spec-workflow-guide 获取工作流指南然后实现任务：角色: 系统集成测试工程师专精端到端测试和AI系统验证 | 任务: 创建全面的集成测试套件，验证所有需求的正确实现和系统协作 | 限制: 必须测试真实的用户场景，确保测试的可靠性和可维护性，不得测试实现细节 | 成功标准: 集成测试覆盖所有关键用户场景，AI分析师与新数据源协作正常，系统整体稳定可靠 | 指令: 在tasks.md中将此任务标记为进行中[-]，完成后标记为已完成[x]_

- [ ] 13. 性能优化和系统监控
  - 文件: 相关模块的性能优化
  - 实现并发数据获取和智能缓存策略
  - 添加性能监控和日志记录
  - 目的: 确保系统性能满足生产环境要求
  - _复用: 现有的日志系统和性能监控工具_
  - _需求: 非功能性需求的性能要求_
  - _参考文件: /Users/yyj/GitProject/adata/adata/stock/market/index_market/market_index.py (并发数据获取模式), market_index_east.py (性能优化示例)_
  - _提示: 实现规范 adata-市场数据集成 任务，首先运行 spec-workflow-guide 获取工作流指南然后实现任务：角色: 性能优化工程师专精系统性能调优和监控 | 任务: 实现性能优化和监控，确保系统满足生产环境性能要求 | 限制: 必须基于现有监控和日志框架，避免过度优化，确保优化不破坏系统稳定性 | 成功标准: 系统性能达到预定目标，监控完善，日志记录有效 | 指令: 在tasks.md中将此任务标记为进行中[-]，完成后标记为已完成[x]_

- [ ] 14. 文档完善和部署准备
  - 文件: docs/ 相关文档和README更新
  - 更新API文档和使用指南
  - 准备部署配置和环境变量说明
  - 目的: 确保项目的可维护性和可部署性
  - _复用: 现有文档模板和部署配置_
  - _需求: 项目整体完整性_
  - _参考文件: /Users/yyj/GitProject/adata/adata/stock/market/__init__.py (模块文档和使用示例), 各子模块的docstring格式_
  - _提示: 实现规范 adata-市场数据集成 任务，首先运行 spec-workflow-guide 获取工作流指南然后实现任务：角色: 技术文档工程师专精API文档和部署指南 | 任务: 完善项目文档和部署配置，确保项目的可维护性和可部署性 | 限制: 必须遵循现有文档标准和格式，确保文档的准确性和完整性，不得遗漏关键配置信息 | 成功标准: 文档完整准确，部署指南清晰，新功能的使用方法说明充分 | 指令: 在tasks.md中将此任务标记为进行中[-]，完成后标记为已完成[x]_